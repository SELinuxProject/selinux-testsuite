
## <summary>test_policy policy</summary>
## <desc>
##      <p>
##              More descriptive text about test_policy.  The <desc>
##              tag can also use <p>, <ul>, and <ol>
##              html tags for formatting.
##      </p>
##      <p>
##              This policy supports the following test_policy features:
##              <ul>
##              <li>Feature A</li>
##              <li>Feature B</li>
##              <li>Feature C</li>
##              </ul>
##      </p>
## </desc>
#

ifdef(`userdom_sysadm_entry_spec_domtrans_to',`', ` dnl
interface(`userdom_sysadm_entry_spec_domtrans_to',`
        gen_require(`
                type sysadm_t;
	')

        domain_entry_file_spec_domtrans(sysadm_t, $1)
        allow $1 sysadm_t:fd use;
        allow $1 sysadm_t:fifo_file rw_file_perms;
        allow $1 sysadm_t:process sigchld;
')
')

interface(`testsuite_domain_type_common',`
	gen_require(`
		attribute testsuite_domain;
	')

	typeattribute $1 testsuite_domain;
')

interface(`testsuite_domain_type',`
	domain_type($1)
	testsuite_domain_type_common($1)

	# task_create and task_setpgid need to exclude these permissions
	# so put them here instead of testsuite_domain_type_common()
	allow $1 self:process { fork setpgid };
')

interface(`testsuite_domain_type_minimal',`
	gen_require(`
		type setrans_var_run_t, unconfined_t;
	')

	testsuite_domain_type_common($1)

	# minimal set of rules to substitute missing domain_type()
	allow $1 proc_t:dir { search };
	allow $1 proc_t:lnk_file { read };
	allow $1 self:dir { search };
	allow $1 self:file { open read write };
	dontaudit $1 security_t:filesystem getattr;
	dontaudit $1 self:file getattr;
	dontaudit $1 setrans_var_run_t:dir search;
	dontaudit unconfined_t $1:process { noatsecure rlimitinh siginh };
')

# Workarounds for refpolicy:

ifdef(`dev_rw_infiniband_dev', `', ` dnl
interface(`dev_rw_infiniband_dev', `
    dev_rw_generic_blk_files($1)
    dev_rw_generic_chr_files($1)
')
')

ifdef(`mount_rw_pid_files', `', ` dnl
interface(`mount_rw_pid_files', `
    mount_rw_runtime_files($1)
')
')

# Refpolicy does not have admin_home_t - assume /root will be user_home_dir_t.
ifdef(`userdom_search_admin_dir', `', ` dnl
interface(`userdom_search_admin_dir', `
    userdom_search_user_home_content($1)
')
')

# If the macro is not defined, then most probably module_request permission
# is just not supported (and relevant operations should be just allowed).
ifdef(`kernel_request_load_module', `', ` dnl
interface(`kernel_request_load_module', `')
')
